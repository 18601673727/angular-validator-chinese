(function(){var h,n,p;h=angular.element;n=angular.module("validator.directive",["validator.provider"]);p=function(n){return{restrict:"A",require:"ngModel",link:function(k,c,g){var a,d,e,f,b,l,r,q,m,s,p;a=n.get("$validator");f=n.get("$parse")(g.ngModel);q=[];m=function(a,d){var b,e,l,m,r,h;null==d&&(d={});l=0;h=[];m=0;for(r=q.length;m<r;m++){e=q[m];switch(a){case "blur":if("blur"!==e.invoke)continue;e.enableError=!0;break;case "watch":if("watch"!==e.invoke&&!e.enableError)continue;break;case "broadcast":e.enableError=
!0}b=e.filter(f(k));!1===b&&"watch"===a?f.assign(k,d.oldValue):f.assign(k,b);h.push(e.validator(f(k),k,c,g,{success:function(){if(++l===q.length)return e.success(k,c,g),"function"===typeof d.success?d.success():void 0},error:function(){e.enableError&&e.error(k,c,g);if(1===("function"===typeof d.error?d.error():void 0))try{return c[0].scrollIntoViewIfNeeded()}catch(a){}}}))}return h};if(e=g.validator.match(/^\/(.*)\/$/))l=a.convertRule("dynamic",{validator:RegExp(e[1]),invoke:g.validatorInvoke,error:g.validatorError}),
q.push(l);if(e=g.validator.match(/^\[(.*)\]$/))for(r=e[1].split(","),s=0,p=r.length;s<p;s++)b=r[s],(l=a.getRule(b.replace(/^\s+|\s+$/g,"")))&&q.push(l);g.required&&(l=a.getRule("required"),null==l&&(l=a.convertRule("required",{validator:/^.+$/,invoke:"watch"})),q.push(l));d=function(a,d){var b,f;if(d){if(a.targetScope===k)return 0===g.ngModel.indexOf(d);for(b=h(c);0!==b.length;){f=b.attr("ng-repeat");if((e=null!=f?f.match(/^.* in (.*)$/):void 0)&&0<=e[1].indexOf(d))return!0;b=b.parent()}return!1}return!0};
k.$on(a.broadcastChannel.prepare,function(a,b){if(d(a,b.model))return b.accept()});k.$on(a.broadcastChannel.start,function(a,b){if(d(a,b.model))return m("broadcast",{success:b.success,error:b.error})});k.$on(a.broadcastChannel.reset,function(a,b){var e,f,m;if(d(a,b.model)){m=[];e=0;for(f=q.length;e<f;e++)l=q[e],m.push(l.success(k,c,g));return m}});k.$watch(g.ngModel,function(a,b){if(a!==b)return m("watch",{oldValue:b})});return h(c).bind("blur",function(){return k.$apply(function(){return m("blur")})})}}};
p.$inject=["$injector"];n.directive("validator",p)}).call(this);(function(){angular.module("validator",["validator.directive"])}).call(this);
(function(){var h;h=angular.element;angular.module("validator.provider",[]).provider("$validator",function(){var n,p,t,k=this;t=p=n=null;this.rules={};this.broadcastChannel={prepare:"$validatePrepare",start:"$validateStart",reset:"$validateReset"};this.setupProviders=function(c){n=c;p=n.get("$q");return t=n.get("$timeout")};this.convertError=function(c){var g;if("function"===typeof c)return c;g=c.constructor===String?c:"";return function(a,d,e){var f,b,c,k;f=h(d).parent();for(a=[];0!==f.length;){if(f.hasClass("form-group")){f.addClass("has-error");
k=f.find("label");b=0;for(c=k.length;b<c;b++)f=k[b],h(f).hasClass("error")&&h(f).remove();f=h("<label class='control-label error'>"+g+"</label>");e.id&&f.attr("for",e.id);h(d).parent().append(f);break}a.push(f=f.parent())}return a}};this.convertSuccess=function(c){return"function"===typeof c?c:function(c,a){var d,e,f,b,l;d=h(a).parent();for(l=[];0!==d.length;){if(d.hasClass("has-error")){d.removeClass("has-error");b=d.find("label");e=0;for(f=b.length;e<f;e++)d=b[e],h(d).hasClass("error")&&h(d).remove();
break}l.push(d=d.parent())}return l}};this.convertValidator=function(c){var g;g=function(){};c.constructor===RegExp?g=function(a,d,e,f,b){null==a&&(a="");return c.test(a)?"function"===typeof b.success?b.success():void 0:"function"===typeof b.error?b.error():void 0}:"function"===typeof c&&(g=function(a,d,e,f,b){return p.all([c(a,d,e,f,n)]).then(function(a){return a&&0<a.length&&a[0]?"function"===typeof b.success?b.success():void 0:"function"===typeof b.error?b.error():void 0},function(){return"function"===
typeof b.error?b.error():void 0})});return g};this.convertRule=function(c,g){var a,d,e,f;null==g&&(g={});a={name:c,enableError:"watch"===g.invoke,invoke:g.invoke,filter:null!=(d=g.filter)?d:function(a){return a},validator:null!=(e=g.validator)?e:function(){return!0},error:null!=(f=g.error)?f:"",success:g.success};a.error=k.convertError(a.error);a.success=k.convertSuccess(a.success);a.validator=k.convertValidator(a.validator);return a};this.register=function(c,g){null==g&&(g={});return this.rules[c]=
this.convertRule(c,g)};this.getRule=function(c){return this.rules[c]?this.rules[c]:null};this.validate=function(c,g){var a,d,e,f,b,l,h;h=p.defer().promise;b=f=e=0;a=[];d=[];h.success=function(b){a.push(b);return h};h.error=function(a){d.push(a);return h};l={model:g,accept:function(){return e++},success:function(){var b,c,d;if(++f===e)for(c=0,d=a.length;c<d;c++)b=a[c],b();return f},error:function(){var a,c,e;if(0===b++)for(c=0,e=d.length;c<e;c++)a=d[c],a();return b}};c.$broadcast(k.broadcastChannel.prepare,
l);t(function(){var b,d,f;if(0===e)for(d=0,f=a.length;d<f;d++)b=a[d],b();else return b=n.get("$validator"),c.$broadcast(b.broadcastChannel.start,l)});return h};this.reset=function(c,g){return c.$broadcast(k.broadcastChannel.reset,{model:g})};this.get=function(c){this.setupProviders(c);return{rules:this.rules,broadcastChannel:this.broadcastChannel,register:this.register,convertRule:this.convertRule,getRule:this.getRule,validate:this.validate,reset:this.reset}};this.get.$inject=["$injector"];return this.$get=
this.get})}).call(this);
