(function(){var m,n,q;m=angular.element;n=angular.module("validator.directive",["validator.provider"]);q=function(n){return{restrict:"A",require:"ngModel",link:function(h,a,c){var f,e,g,b,d,k,l,p,r,t,q;e=n.get("$validator");f=n.get("$parse");d=f(c.ngModel);p=[];r=function(e,b){var f,s,k,g,r,l;null==b&&(b={});k=0;l=[];g=0;for(r=p.length;g<r;g++){s=p[g];switch(e){case "blur":if("blur"!==s.invoke)continue;s.enableError=!0;break;case "watch":if("watch"!==s.invoke&&!s.enableError)continue;break;case "broadcast":s.enableError=
!0}f=s.filter(d(h));!1===f&&"watch"===e?d.assign(h,b.oldValue):d.assign(h,f);l.push(s.validator(d(h),h,a,c,{success:function(){if(++k===p.length)return s.success(h,a,c),"function"===typeof b.success?b.success():void 0},error:function(){s.enableError&&s.error(h,a,c);if(1===("function"===typeof b.error?b.error():void 0))try{return a[0].scrollIntoViewIfNeeded()}catch(f){}}}))}return l};if(b=c.validator.match(/^\/(.*)\/$/))k=e.convertRule("dynamic",{validator:RegExp(b[1]),invoke:c.validatorInvoke,error:c.validatorError}),
p.push(k);if(b=c.validator.match(/^\[(.*)\]$/))for(l=b[1].split(","),t=0,q=l.length;t<q;t++)b=l[t],(k=e.getRule(b.replace(/^\s+|\s+$/g,"")))&&p.push(k);c.$observe("required",function(c,b){var f,a,d,g;if(c)return k=e.getRule("required"),null==k&&(k=e.convertRule("required",{validator:/^.+$/,invoke:"watch"})),p.push(k);if(c!==b){g=[];f=a=0;for(d=p.length-1;a<=d;f=a+=1)if("required"===p[f].name){p.splice(f,1);break}return g}});g=function(b,a){var e,d;if(a){if(b.targetScope===h)return 0===c.ngModel.indexOf(a);
e=function(b,a){var c,d;for(c in b)switch(d=b[c],typeof d){case "string":if("$$hashKey"===c&&d===a)return!0;break;case "object":if(e(d,a))return!0}return!1};d=c.ngModel.indexOf(".");d=0<=d?c.ngModel.substr(0,d):c.ngModel;d=f(d)(h);return e(f(a)(b.targetScope),d.$$hashKey)}return!0};h.$on(e.broadcastChannel.prepare,function(b,a){if(g(b,a.model))return a.accept()});h.$on(e.broadcastChannel.start,function(a,b){if(g(a,b.model))return r("broadcast",{success:b.success,error:b.error})});h.$on(e.broadcastChannel.reset,
function(b,d){var f,e,r;if(g(b,d.model)){r=[];f=0;for(e=p.length;f<e;f++)k=p[f],r.push(k.success(h,a,c));return r}});h.$watch(c.ngModel,function(b,a){if(b!==a)return r("watch",{oldValue:a})});return m(a).bind("blur",function(){return h.$apply(function(){return r("blur")})})}}};q.$inject=["$injector"];n.directive("validator",q)}).call(this);(function(){angular.module("validator",["validator.directive"])}).call(this);
(function(){var m;m=angular.element;angular.module("validator.provider",[]).provider("$validator",function(){var n,q,u,h=this;u=q=n=null;this.rules={};this.broadcastChannel={prepare:"$validatePrepare",start:"$validateStart",reset:"$validateReset"};this.setupProviders=function(a){n=a;q=n.get("$q");return u=n.get("$timeout")};this.convertError=function(a){var c;if("function"===typeof a)return a;c=a.constructor===String?a:"";return function(a,e,g){var b,d,k,h;b=m(e).parent();for(a=[];0!==b.length;){if(b.hasClass("form-group")){b.addClass("has-error");
h=b.find("label");d=0;for(k=h.length;d<k;d++)b=h[d],m(b).hasClass("error")&&m(b).remove();b=m("<label class='control-label error'>"+c+"</label>");g.id&&b.attr("for",g.id);m(e).parent().append(b);break}a.push(b=b.parent())}return a}};this.convertSuccess=function(a){return"function"===typeof a?a:function(a,f){var e,g,b,d,k;e=m(f).parent();for(k=[];0!==e.length;){if(e.hasClass("has-error")){e.removeClass("has-error");d=e.find("label");g=0;for(b=d.length;g<b;g++)e=d[g],m(e).hasClass("error")&&m(e).remove();
break}k.push(e=e.parent())}return k}};this.convertValidator=function(a){var c;c=function(){};a.constructor===RegExp?c=function(c,e,g,b,d){null==c&&(c="");return a.test(c)?"function"===typeof d.success?d.success():void 0:"function"===typeof d.error?d.error():void 0}:"function"===typeof a&&(c=function(c,e,g,b,d){return q.all([a(c,e,g,b,n)]).then(function(a){return a&&0<a.length&&a[0]?"function"===typeof d.success?d.success():void 0:"function"===typeof d.error?d.error():void 0},function(){return"function"===
typeof d.error?d.error():void 0})});return c};this.convertRule=function(a,c){var f,e,g,b;null==c&&(c={});f={name:a,enableError:"watch"===c.invoke,invoke:c.invoke,filter:null!=(e=c.filter)?e:function(a){return a},validator:null!=(g=c.validator)?g:function(){return!0},error:null!=(b=c.error)?b:"",success:c.success};f.error=h.convertError(f.error);f.success=h.convertSuccess(f.success);f.validator=h.convertValidator(f.validator);return f};this.register=function(a,c){null==c&&(c={});return this.rules[a]=
this.convertRule(a,c)};this.getRule=function(a){return this.rules[a]?this.rules[a]:null};this.validate=function(a,c){var f,e,g,b,d,k,l;l=q.defer().promise;d=b=g=0;f=[];e=[];l.success=function(a){f.push(a);return l};l.error=function(a){e.push(a);return l};k={model:c,accept:function(){return g++},success:function(){var a,c,d;if(++b===g)for(c=0,d=f.length;c<d;c++)a=f[c],a();return b},error:function(){var a,b,c;if(0===d++)for(b=0,c=e.length;b<c;b++)a=e[b],a();return d}};a.$broadcast(h.broadcastChannel.prepare,
k);u(function(){var b,c,d;if(0===g)for(c=0,d=f.length;c<d;c++)b=f[c],b();else return b=n.get("$validator"),a.$broadcast(b.broadcastChannel.start,k)});return l};this.reset=function(a,c){return a.$broadcast(h.broadcastChannel.reset,{model:c})};this.get=function(a){this.setupProviders(a);return{rules:this.rules,broadcastChannel:this.broadcastChannel,register:this.register,convertRule:this.convertRule,getRule:this.getRule,validate:this.validate,reset:this.reset}};this.get.$inject=["$injector"];this.$get=
this.get})}).call(this);
