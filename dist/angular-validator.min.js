(function(){var q,s,t;q=angular.element;s=angular.module("validator.directive",["validator.provider"]);t=function(r){return{restrict:"A",require:"ngModel",link:function(g,d,c){var a,b,f,m,e,h,n,l,k;b=r.get("$validator");a=r.get("$parse");m=a(c.ngModel);l=[];k=function(u,p){var a,b,e,f,k,h;null==p&&(p={});e=0;a=function(){var b,a,u;if(++e===l.length){a=0;for(u=l.length;a<u;a++)b=l[a],b.success(m(g),g,d,c,r);"function"===typeof p.success&&p.success()}};h=[];f=0;for(k=l.length;f<k;f++){b=l[f];switch(u){case "blur":if("blur"!==
b.invoke)continue;b.enableError=!0;break;case "watch":if("watch"!==b.invoke&&!b.enableError){a();continue}break;case "broadcast":b.enableError=!0}h.push(b.validator(m(g),g,d,c,{success:function(){return a()},error:function(){b.enableError&&b.error(m(g),g,d,c,r);if(1===("function"===typeof p.error?p.error():void 0))try{return d[0].scrollIntoViewIfNeeded()}catch(a){}}}))}return h};h=function(){var a;a=b.getRule("required");null==a&&(a=b.convertRule("required",{validator:/^.+$/,invoke:"watch"}));return l.push(a)};
n=function(a){var b,e,f,k,h;h=[];b=e=0;for(f=l.length;e<f;b=e+=1)(null!=(k=l[b])?k.name:void 0)===a&&(l[b].success(m(g),g,d,c,r),l.splice(b,1),h.push(b--));return h};c.$observe("validator",function(a){var p,f,k,m;l.length=0;(e.validatorRequired||e.required)&&h();if(p=a.match(/^\/(.*)\/$/))f=b.convertRule("dynamic",{validator:RegExp(p[1]),invoke:c.validatorInvoke,error:c.validatorError}),l.push(f);else if(p=a.match(/^\[(.*)\]$/)){a=p[1].split(",");m=[];p=0;for(k=a.length;p<k;p++)f=a[p],f=b.getRule(f.replace(/^\s+|\s+$/g,
"")),"function"===typeof f.init&&f.init(g,d,c,r),f?m.push(l.push(f)):m.push(void 0);return m}});c.$observe("validatorError",function(a){var f;if(f=c.validator.match(/^\/(.*)\/$/))return n("dynamic"),a=b.convertRule("dynamic",{validator:RegExp(f[1]),invoke:c.validatorInvoke,error:a}),l.push(a)});e={validatorRequired:!1,required:!1};c.$observe("validatorRequired",function(a){if(a&&"false"!==a)return h(),e.validatorRequired=!0;if(e.validatorRequired)return n("required"),e.validatorRequired=!1});c.$observe("required",
function(a){if(a&&"false"!==a)return h(),e.required=!0;if(e.required)return n("required"),e.required=!1});f=function(b,f){var d,e;if(f){if(c.validatorGroup===f)return!0;if(b.targetScope===g)return 0===c.ngModel.indexOf(f);d=function(a,b){var c,f;for(c in a)switch(f=a[c],typeof f){case "string":if("$$hashKey"===c&&f===b)return!0;break;case "object":if(d(f,b))return!0}return!1};e=c.ngModel.indexOf(".");e=0<=e?c.ngModel.substr(0,e):c.ngModel;e=a(e)(g);return d(a(f)(b.targetScope),e.$$hashKey)}return!0};
g.$on(b.broadcastChannel.prepare,function(a,b){if(f(a,b.model))return b.accept()});g.$on(b.broadcastChannel.start,function(a,b){if(f(a,b.model))return k("broadcast",{success:b.success,error:b.error})});g.$on(b.broadcastChannel.reset,function(a,b){var e,k,h,n;if(f(a,b.model)){n=[];k=0;for(h=l.length;k<h;k++)e=l[k],n.push(e.success(m(g),g,d,c,r));return n}});g.$watch(c.ngModel,function(a,b){if(a!==b)return k("watch",{oldValue:b})});return q(d).bind("blur",function(){return g.$apply(function(){return k("blur")})})}}};
t.$inject=["$injector"];s.directive("validator",t)}).call(this);(function(){angular.module("validator",["validator.directive"])}).call(this);
(function(){var q;q=angular.element;angular.module("validator.provider",[]).provider("$validator",function(){var s,t,r,g=this;r=t=s=null;this.rules={};this.broadcastChannel={prepare:"$validatePrepare",start:"$validateStart",reset:"$validateReset"};this.setupProviders=function(d){s=d;t=s.get("$q");return r=s.get("$timeout")};this.convertError=function(d){var c;if("function"===typeof d)return d;c=d.constructor===String?d:"";return function(a,b,f,d){var e,h,g;b=q(f).parent();for(a=[];0!==b.length;){if(b.hasClass("form-group")){b.addClass("has-error");
g=b.find("label");e=0;for(h=g.length;e<h;e++)b=g[e],q(b).hasClass("error")&&q(b).remove();b=q("<label class='control-label error'>"+c+"</label>");d.id&&b.attr("for",d.id);q(f).parent().append(b);break}a.push(b=b.parent())}return a}};this.convertSuccess=function(d){return"function"===typeof d?d:function(c,a,b){var f,d;a=q(b).parent();for(c=[];0!==a.length;){if(a.hasClass("has-error")){a.removeClass("has-error");d=a.find("label");b=0;for(f=d.length;b<f;b++)a=d[b],q(a).hasClass("error")&&q(a).remove();
break}c.push(a=a.parent())}return c}};this.convertValidator=function(d){var c;c=function(){};d.constructor===RegExp?c=function(a,b,c,g,e){null==a&&(a="");return d.test(a)?"function"===typeof e.success?e.success():void 0:"function"===typeof e.error?e.error():void 0}:"function"===typeof d&&(c=function(a,b,c,g,e){return t.all([d(a,b,c,g,s)]).then(function(a){return a&&0<a.length&&a[0]?"function"===typeof e.success?e.success():void 0:"function"===typeof e.error?e.error():void 0},function(){return"function"===
typeof e.error?e.error():void 0})});return c};this.convertRule=function(d,c){var a,b,f;null==c&&(c={});a={name:d,enableError:"watch"===c.invoke,invoke:c.invoke,init:c.init,validator:null!=(b=c.validator)?b:function(){return!0},error:null!=(f=c.error)?f:"",success:c.success};a.error=g.convertError(a.error);a.success=g.convertSuccess(a.success);a.validator=g.convertValidator(a.validator);return a};this.register=function(d,c){null==c&&(c={});return this.rules[d]=this.convertRule(d,c)};this.getRule=function(d){return this.rules[d]?
this.rules[d]:null};this.validate=function(d,c){var a,b,f,m,e,h,n;n=t.defer().promise;e=m=f=0;a=[];b=[];n.success=function(b){a.push(b);return n};n.error=function(a){b.push(a);return n};h={model:c,accept:function(){return f++},success:function(){var b,c,d;if(++m===f)for(c=0,d=a.length;c<d;c++)b=a[c],b();return m},error:function(){var a,c,d;if(0===e++)for(c=0,d=b.length;c<d;c++)a=b[c],a();return e}};d.$broadcast(g.broadcastChannel.prepare,h);r(function(){var b,c,e;if(0===f)for(c=0,e=a.length;c<e;c++)b=
a[c],b();else return b=s.get("$validator"),d.$broadcast(b.broadcastChannel.start,h)});return n};this.reset=function(d,c){return d.$broadcast(g.broadcastChannel.reset,{model:c})};this.get=function(d){this.setupProviders(d);return{rules:this.rules,broadcastChannel:this.broadcastChannel,register:this.register,convertRule:this.convertRule,getRule:this.getRule,validate:this.validate,reset:this.reset}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);
