(function(){var n,g,m;n=angular.element;g=angular.module("validator.directive",[]);m=function(g){return{restrict:"A",require:"ngModel",link:function(k,m,b){var e,d,p,a,f,h,l,c;e=g.get("$validator");p=g.get("$parse")(b.ngModel);f=[];h=function(a,c){var h,l,d,e,g;null==c&&(c={success:function(){},error:function(){}});l=0;g=[];d=0;for(e=f.length;d<e;d++){h=f[d];if("broadcast"===a||"blur"===a)h.enableError=!0;if("broadcast"===a||a===h.invoke)p.assign(k,h.filter(p(k))),g.push(h.validator(p(k),m,b,{success:function(){if(++l===
f.length)return c.success()},error:function(){return c.error()}}))}return g};if(d=b.validator.match(/^\/(.*)\/$/))d=e.convertRule({validator:RegExp(d[1]),invoke:b.validatorInvoke,error:b.validatorError}),f.push(d);if(d=b.validator.match(/^\[(.*)\]$/))for(a=d[1].split(","),l=0,c=a.length;l<c;l++)d=a[l],f.push(e.getRule(d.trim()));k.$on(e.broadcastChannel.prepare,function(a,c){if(!c.model||0===b.ngModel.indexOf(c.model))return c.accept()});k.$on(e.broadcastChannel.start,function(c,a){if(!a.model||0===
b.ngModel.indexOf(a.model))return h("broadcast",{success:a.success,error:a.error})});k.$watch(b.ngModel,function(a,c){if(a!==c)return h("watch")});return n(m).bind("blur",function(){return k.$apply(function(){return h("blur")})})}}};m.$inject=["$injector"];g.directive("validator",m)}).call(this);(function(){angular.module("validator",["validator.provider","validator.directive"])}).call(this);
(function(){var n;n=angular.element;angular.module("validator.provider",[]).provider("$validator",function(){var g,m,q,k,r=this;m=g=null;this.rules={};this.broadcastChannel={prepare:"$validateStartPrepare",start:"$validateStartStart"};q={all:function(){for(var b in this)if("all"!==b)this[b]()}};k=function(b){g=b;return m=g.get("$q")};this.convertRule=function(b){var e,d,k,a,f;null==b&&(b={});a={enableError:"watch"===b.invoke,invoke:b.invoke,filter:b.filter,validator:b.validator,error:b.error,success:b.success};
null==a.filter&&(a.filter=function(a){return a});null==a.validator&&(a.validator=function(){return!0});null==a.error&&(a.error="");a.error.constructor===String&&(e=a.error,a.error=function(a,b){var c,d;c=n(a).parent();for(d=1;3>=d;++d){if(c.hasClass("form-group")){if(c.hasClass("has-error"))break;n(a).parent().append("<label class='control-label error'>"+e+"</label>");c.addClass("has-error");break}c=c.parent()}});f=function(a,b){var c,d,e,g,f;c=n(a).parent();f=[];for(d=1;3>=d;++d){if(c.hasClass("has-error")){c.removeClass("has-error");
g=c.find("label");d=0;for(e=g.length;d<e;d++)if(c=g[d],n(c).hasClass("error")){c.remove();break}break}f.push(c=c.parent())}return f};a.success&&"function"===typeof a.success?(d=a.success,a.success=function(a,b){d(a,b);return f(a,b)}):a.success=f;a.validator.constructor===RegExp?(k=a.validator,a.validator=function(b,d,c,e){if(k.test(b))return a.success(d,c),"function"===typeof e.success?e.success():void 0;a.enableError&&a.error(d,c);return"function"===typeof e.error?e.error():void 0}):"function"===
typeof a.validator&&(d=a.validator,a.validator=function(b,e,c,f){return m.all([d(b,e,c,g)]).then(function(b){if(b&&0<b.length&&b[0])return a.success(e,c),"function"===typeof f.success?f.success():void 0;a.enableError&&a.error(e,c);return"function"===typeof f.error?f.error():void 0})});return a};this.register=function(b,e){null==e&&(e={});return this.rules[b]=this.convertRule(e)};this.getRule=function(b){return this.rules[b]?this.rules[b]:null};this.validate=function(b,e){var d,k,a,f,h,l;l=m.defer().promise;
a=k=d=0;h={success:function(){},error:function(){},accept:function(){return d++},validatedSuccess:function(){if(++k===d)return h.success()},validatedError:function(){if(0===a++)return h.error()}};l.success=function(a){return h.success=a};l.error=function(a){return h.error=a};f={model:e,accept:h.accept,success:h.validatedSuccess,error:h.validatedError};b.$broadcast(r.broadcastChannel.prepare,f);setTimeout(function(){return b.$apply(function(){var a;a=g.get("$validator");return b.$broadcast(a.broadcastChannel.start,
f)})},0);return l};this.get=function(b){k(b);q.all();return{rules:this.rules,broadcastChannel:this.broadcastChannel,convertRule:this.convertRule,getRule:this.getRule,validate:this.validate}};this.get.$inject=["$injector"];return this.$get=this.get})}).call(this);
