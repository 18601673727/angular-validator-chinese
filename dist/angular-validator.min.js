(function(){var m,p,r;m=angular.element;p=angular.module("validator.directive",["validator.provider"]);r=function(p){return{restrict:"A",require:"ngModel",link:function(h,d,e){var b,c,g,f,a,k,t,n,q;c=p.get("$validator");b=p.get("$parse");f=b(e.ngModel);n=[];q=function(l,s){var c,a,b,g,k,q;null==s&&(s={});b=0;c=function(){var a,l,c;if(++b===n.length){l=0;for(c=n.length;l<c;l++)a=n[l],a.success(h,d,e);"function"===typeof s.success&&s.success()}};q=[];g=0;for(k=n.length;g<k;g++){a=n[g];switch(l){case "blur":if("blur"!==
a.invoke)continue;a.enableError=!0;break;case "watch":if("watch"!==a.invoke&&!a.enableError){c();continue}break;case "broadcast":a.enableError=!0}q.push(a.validator(f(h),h,d,e,{success:function(){return c()},error:function(){a.enableError&&a.error(h,d,e);if(1===("function"===typeof s.error?s.error():void 0))try{return d[0].scrollIntoViewIfNeeded()}catch(l){}}}))}return q};k=function(){var l;l=c.getRule("required");null==l&&(l=c.convertRule("required",{validator:/^.+$/,invoke:"watch"}));return n.push(l)};
t=function(l){var a,c,b,g,f;f=[];a=c=0;for(b=n.length;c<b;a=c+=1)(null!=(g=n[a])?g.name:void 0)===l&&(n[a].success(h,d,e),n.splice(a,1),f.push(a--));return f};e.$observe("validator",function(l){var b,d,g,f;n.length=0;(a.validatorRequired||a.required)&&k();if(b=l.match(/^\/(.*)\/$/))d=c.convertRule("dynamic",{validator:RegExp(b[1]),invoke:e.validatorInvoke,error:e.validatorError}),n.push(d);else if(b=l.match(/^\[(.*)\]$/)){l=b[1].split(",");f=[];b=0;for(g=l.length;b<g;b++)d=l[b],(d=c.getRule(d.replace(/^\s+|\s+$/g,
"")))?f.push(n.push(d)):f.push(void 0);return f}});e.$observe("validatorError",function(a){var b;if(b=e.validator.match(/^\/(.*)\/$/))return t("dynamic"),a=c.convertRule("dynamic",{validator:RegExp(b[1]),invoke:e.validatorInvoke,error:a}),n.push(a)});a={validatorRequired:!1,required:!1};e.$observe("validatorRequired",function(b){if(b&&"false"!==b)return k(),a.validatorRequired=!0;if(a.validatorRequired)return t("required"),a.validatorRequired=!1});e.$observe("required",function(b){if(b&&"false"!==
b)return k(),a.required=!0;if(a.required)return t("required"),a.required=!1});g=function(a,c){var d,f;if(c){if(e.validatorGroup===c)return!0;if(a.targetScope===h)return 0===e.ngModel.indexOf(c);d=function(a,b){var c,e;for(c in a)switch(e=a[c],typeof e){case "string":if("$$hashKey"===c&&e===b)return!0;break;case "object":if(d(e,b))return!0}return!1};f=e.ngModel.indexOf(".");f=0<=f?e.ngModel.substr(0,f):e.ngModel;f=b(f)(h);return d(b(c)(a.targetScope),f.$$hashKey)}return!0};h.$on(c.broadcastChannel.prepare,
function(a,b){if(g(a,b.model))return b.accept()});h.$on(c.broadcastChannel.start,function(a,b){if(g(a,b.model))return q("broadcast",{success:b.success,error:b.error})});h.$on(c.broadcastChannel.reset,function(a,b){var c,f,q,k;if(g(a,b.model)){k=[];f=0;for(q=n.length;f<q;f++)c=n[f],k.push(c.success(h,d,e));return k}});h.$watch(e.ngModel,function(a,b){if(a!==b)return q("watch",{oldValue:b})});return m(d).bind("blur",function(){return h.$apply(function(){return q("blur")})})}}};r.$inject=["$injector"];
p.directive("validator",r)}).call(this);(function(){angular.module("validator",["validator.directive"])}).call(this);
(function(){var m;m=angular.element;angular.module("validator.provider",[]).provider("$validator",function(){var p,r,u,h=this;u=r=p=null;this.rules={};this.broadcastChannel={prepare:"$validatePrepare",start:"$validateStart",reset:"$validateReset"};this.setupProviders=function(d){p=d;r=p.get("$q");return u=p.get("$timeout")};this.convertError=function(d){var e;if("function"===typeof d)return d;e=d.constructor===String?d:"";return function(b,c,d){var f,a,k,h;f=m(c).parent();for(b=[];0!==f.length;){if(f.hasClass("form-group")){f.addClass("has-error");
h=f.find("label");a=0;for(k=h.length;a<k;a++)f=h[a],m(f).hasClass("error")&&m(f).remove();f=m("<label class='control-label error'>"+e+"</label>");d.id&&f.attr("for",d.id);m(c).parent().append(f);break}b.push(f=f.parent())}return b}};this.convertSuccess=function(d){return"function"===typeof d?d:function(d,b){var c,g,f,a,k;c=m(b).parent();for(k=[];0!==c.length;){if(c.hasClass("has-error")){c.removeClass("has-error");a=c.find("label");g=0;for(f=a.length;g<f;g++)c=a[g],m(c).hasClass("error")&&m(c).remove();
break}k.push(c=c.parent())}return k}};this.convertValidator=function(d){var e;e=function(){};d.constructor===RegExp?e=function(b,c,e,f,a){null==b&&(b="");return d.test(b)?"function"===typeof a.success?a.success():void 0:"function"===typeof a.error?a.error():void 0}:"function"===typeof d&&(e=function(b,c,e,f,a){return r.all([d(b,c,e,f,p)]).then(function(b){return b&&0<b.length&&b[0]?"function"===typeof a.success?a.success():void 0:"function"===typeof a.error?a.error():void 0},function(){return"function"===
typeof a.error?a.error():void 0})});return e};this.convertRule=function(d,e){var b,c,g;null==e&&(e={});b={name:d,enableError:"watch"===e.invoke,invoke:e.invoke,validator:null!=(c=e.validator)?c:function(){return!0},error:null!=(g=e.error)?g:"",success:e.success};b.error=h.convertError(b.error);b.success=h.convertSuccess(b.success);b.validator=h.convertValidator(b.validator);return b};this.register=function(d,e){null==e&&(e={});return this.rules[d]=this.convertRule(d,e)};this.getRule=function(d){return this.rules[d]?
this.rules[d]:null};this.validate=function(d,e){var b,c,g,f,a,k,m;m=r.defer().promise;a=f=g=0;b=[];c=[];m.success=function(a){b.push(a);return m};m.error=function(b){c.push(b);return m};k={model:e,accept:function(){return g++},success:function(){var a,c,d;if(++f===g)for(c=0,d=b.length;c<d;c++)a=b[c],a();return f},error:function(){var b,d,e;if(0===a++)for(d=0,e=c.length;d<e;d++)b=c[d],b();return a}};d.$broadcast(h.broadcastChannel.prepare,k);u(function(){var a,c,e;if(0===g)for(c=0,e=b.length;c<e;c++)a=
b[c],a();else return a=p.get("$validator"),d.$broadcast(a.broadcastChannel.start,k)});return m};this.reset=function(d,e){return d.$broadcast(h.broadcastChannel.reset,{model:e})};this.get=function(d){this.setupProviders(d);return{rules:this.rules,broadcastChannel:this.broadcastChannel,register:this.register,convertRule:this.convertRule,getRule:this.getRule,validate:this.validate,reset:this.reset}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);
