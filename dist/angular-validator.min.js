(function(){var p,q,s;p=angular.element;q=angular.module("validator.directive",["validator.provider"]);s=function(q){return{restrict:"A",require:"ngModel",link:function(h,a,e){var b,c,k,d,g,m,n;c=q.get("$validator");b=q.get("$parse");d=b(e.ngModel);m=[];n=function(u,f){var l,r,c,b,g,k;null==f&&(f={});c=0;k=[];b=0;for(g=m.length;b<g;b++){r=m[b];switch(u){case "blur":if("blur"!==r.invoke)continue;r.enableError=!0;break;case "watch":if("watch"!==r.invoke&&!r.enableError)continue;break;case "broadcast":r.enableError=
!0}l=r.filter(d(h));!1===l&&"watch"===u?d.assign(h,f.oldValue):d.assign(h,l);k.push(r.validator(d(h),h,a,e,{success:function(){if(++c===m.length)return r.success(h,a,e),"function"===typeof f.success?f.success():void 0},error:function(){r.enableError&&r.error(h,a,e);if(1===("function"===typeof f.error?f.error():void 0))try{return a[0].scrollIntoViewIfNeeded()}catch(l){}}}))}return k};g=function(e){var f,l,b,a;a=[];f=l=0;for(b=m.length-1;l<=b;f=l+=1)m[f].name===e&&(m.splice(f,1),a.push(f--));return a};
e.$observe("validator",function(a,f){var l,b,d,k,h;if(f&&a!==f){if(l=f.match(/^\/(.*)\/$/)){g("dynamic");return}if(l=f.match(/^\[(.*)\]$/))for(l=l[1].split(","),d=0,k=l.length;d<k;d++)b=l[d],g(b.replace(/^\s+|\s+$/g,""))}if(a)if(l=a.match(/^\/(.*)\/$/))b=c.convertRule("dynamic",{validator:RegExp(l[1]),invoke:e.validatorInvoke,error:e.validatorError}),m.push(b);else if(l=a.match(/^\[(.*)\]$/)){l=l[1].split(",");h=[];d=0;for(k=l.length;d<k;d++)b=l[d],(b=c.getRule(b.replace(/^\s+|\s+$/g,"")))?h.push(m.push(b)):
h.push(void 0);return h}});e.$observe("required",function(b,f){var a;f&&b!==f&&g("required");if(b)return a=c.getRule("required"),null==a&&(a=c.convertRule("required",{validator:/^.+$/,invoke:"watch"})),m.push(a)});k=function(a,f){var d,c;if(f){if(a.targetScope===h)return 0===e.ngModel.indexOf(f);d=function(a,b){var f,c;for(f in a)switch(c=a[f],typeof c){case "string":if("$$hashKey"===f&&c===b)return!0;break;case "object":if(d(c,b))return!0}return!1};c=e.ngModel.indexOf(".");c=0<=c?e.ngModel.substr(0,
c):e.ngModel;c=b(c)(h);return d(b(f)(a.targetScope),c.$$hashKey)}return!0};h.$on(c.broadcastChannel.prepare,function(a,f){if(k(a,f.model))return f.accept()});h.$on(c.broadcastChannel.start,function(a,f){if(k(a,f.model))return n("broadcast",{success:f.success,error:f.error})});h.$on(c.broadcastChannel.reset,function(b,f){var c,d,g,n;if(k(b,f.model)){n=[];d=0;for(g=m.length;d<g;d++)c=m[d],n.push(c.success(h,a,e));return n}});h.$watch(e.ngModel,function(a,b){if(a!==b)return n("watch",{oldValue:b})});
return p(a).bind("blur",function(){return h.$apply(function(){return n("blur")})})}}};s.$inject=["$injector"];q.directive("validator",s)}).call(this);(function(){angular.module("validator",["validator.directive"])}).call(this);
(function(){var p;p=angular.element;angular.module("validator.provider",[]).provider("$validator",function(){var q,s,t,h=this;t=s=q=null;this.rules={};this.broadcastChannel={prepare:"$validatePrepare",start:"$validateStart",reset:"$validateReset"};this.setupProviders=function(a){q=a;s=q.get("$q");return t=q.get("$timeout")};this.convertError=function(a){var e;if("function"===typeof a)return a;e=a.constructor===String?a:"";return function(a,c,k){var d,g,m,h;d=p(c).parent();for(a=[];0!==d.length;){if(d.hasClass("form-group")){d.addClass("has-error");
h=d.find("label");g=0;for(m=h.length;g<m;g++)d=h[g],p(d).hasClass("error")&&p(d).remove();d=p("<label class='control-label error'>"+e+"</label>");k.id&&d.attr("for",k.id);p(c).parent().append(d);break}a.push(d=d.parent())}return a}};this.convertSuccess=function(a){return"function"===typeof a?a:function(a,b){var c,k,d,g,h;c=p(b).parent();for(h=[];0!==c.length;){if(c.hasClass("has-error")){c.removeClass("has-error");g=c.find("label");k=0;for(d=g.length;k<d;k++)c=g[k],p(c).hasClass("error")&&p(c).remove();
break}h.push(c=c.parent())}return h}};this.convertValidator=function(a){var e;e=function(){};a.constructor===RegExp?e=function(b,c,e,d,g){null==b&&(b="");return a.test(b)?"function"===typeof g.success?g.success():void 0:"function"===typeof g.error?g.error():void 0}:"function"===typeof a&&(e=function(b,c,e,d,g){return s.all([a(b,c,e,d,q)]).then(function(a){return a&&0<a.length&&a[0]?"function"===typeof g.success?g.success():void 0:"function"===typeof g.error?g.error():void 0},function(){return"function"===
typeof g.error?g.error():void 0})});return e};this.convertRule=function(a,e){var b,c,k,d;null==e&&(e={});b={name:a,enableError:"watch"===e.invoke,invoke:e.invoke,filter:null!=(c=e.filter)?c:function(a){return a},validator:null!=(k=e.validator)?k:function(){return!0},error:null!=(d=e.error)?d:"",success:e.success};b.error=h.convertError(b.error);b.success=h.convertSuccess(b.success);b.validator=h.convertValidator(b.validator);return b};this.register=function(a,e){null==e&&(e={});return this.rules[a]=
this.convertRule(a,e)};this.getRule=function(a){return this.rules[a]?this.rules[a]:null};this.validate=function(a,e){var b,c,k,d,g,m,n;n=s.defer().promise;g=d=k=0;b=[];c=[];n.success=function(a){b.push(a);return n};n.error=function(a){c.push(a);return n};m={model:e,accept:function(){return k++},success:function(){var a,f,c;if(++d===k)for(f=0,c=b.length;f<c;f++)a=b[f],a();return d},error:function(){var a,b,d;if(0===g++)for(b=0,d=c.length;b<d;b++)a=c[b],a();return g}};a.$broadcast(h.broadcastChannel.prepare,
m);t(function(){var c,d,e;if(0===k)for(d=0,e=b.length;d<e;d++)c=b[d],c();else return c=q.get("$validator"),a.$broadcast(c.broadcastChannel.start,m)});return n};this.reset=function(a,e){return a.$broadcast(h.broadcastChannel.reset,{model:e})};this.get=function(a){this.setupProviders(a);return{rules:this.rules,broadcastChannel:this.broadcastChannel,register:this.register,convertRule:this.convertRule,getRule:this.getRule,validate:this.validate,reset:this.reset}};this.get.$inject=["$injector"];this.$get=
this.get})}).call(this);
