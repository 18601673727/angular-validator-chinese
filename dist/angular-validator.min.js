(function(){var l,p,r;l=angular.element;p=angular.module("validator.directive",["validator.provider"]);r=function(p){return{restrict:"A",require:"ngModel",link:function(h,a,c){var f,b,g,d,e,k,u,n,q;b=p.get("$validator");f=p.get("$parse");d=f(c.ngModel);n=[];q=function(m,s){var e,b,f,g,k,q;null==s&&(s={});f=0;q=[];g=0;for(k=n.length;g<k;g++){b=n[g];switch(m){case "blur":if("blur"!==b.invoke)continue;b.enableError=!0;break;case "watch":if("watch"!==b.invoke&&!b.enableError)continue;break;case "broadcast":b.enableError=
!0}e=b.filter(d(h));!1===e&&"watch"===m?d.assign(h,s.oldValue):d.assign(h,e);q.push(b.validator(d(h),h,a,c,{success:function(){if(++f===n.length)return b.success(h,a,c),"function"===typeof s.success?s.success():void 0},error:function(){b.enableError&&b.error(h,a,c);if(1===("function"===typeof s.error?s.error():void 0))try{return a[0].scrollIntoViewIfNeeded()}catch(m){}}}))}return q};k=function(){var m;m=b.getRule("required");null==m&&(m=b.convertRule("required",{validator:/^.+$/,invoke:"watch"}));
return n.push(m)};u=function(b){var c,e,a,f,d;d=[];c=e=0;for(a=n.length-1;e<=a;c=e+=1)(null!=(f=n[c])?f.name:void 0)===b&&(n.splice(c,1),d.push(c--));return d};c.$observe("validator",function(m){var a,f,d,g;n.length=0;(e.validatorRequired||e.required)&&k();if(a=m.match(/^\/(.*)\/$/))f=b.convertRule("dynamic",{validator:RegExp(a[1]),invoke:c.validatorInvoke,error:c.validatorError}),n.push(f);else if(a=m.match(/^\[(.*)\]$/)){m=a[1].split(",");g=[];a=0;for(d=m.length;a<d;a++)f=m[a],(f=b.getRule(f.replace(/^\s+|\s+$/g,
"")))?g.push(n.push(f)):g.push(void 0);return g}});e={validatorRequired:!1,required:!1};c.$observe("validatorRequired",function(a){if(a&&"false"!==a)return k(),e.validatorRequired=!0;if(e.validatorRequired)return u("required"),e.validatorRequired=!1});c.$observe("required",function(a){if(a&&"false"!==a)return k(),e.required=!0;if(e.required)return u("required"),e.required=!1});g=function(a,b){var e,d;if(b){if(a.targetScope===h)return 0===c.ngModel.indexOf(b);e=function(a,b){var c,d;for(c in a)switch(d=
a[c],typeof d){case "string":if("$$hashKey"===c&&d===b)return!0;break;case "object":if(e(d,b))return!0}return!1};d=c.ngModel.indexOf(".");d=0<=d?c.ngModel.substr(0,d):c.ngModel;d=f(d)(h);return e(f(b)(a.targetScope),d.$$hashKey)}return!0};h.$on(b.broadcastChannel.prepare,function(a,b){if(g(a,b.model))return b.accept()});h.$on(b.broadcastChannel.start,function(a,b){if(g(a,b.model))return q("broadcast",{success:b.success,error:b.error})});h.$on(b.broadcastChannel.reset,function(b,d){var e,f,q,k;if(g(b,
d.model)){k=[];f=0;for(q=n.length;f<q;f++)e=n[f],k.push(e.success(h,a,c));return k}});h.$watch(c.ngModel,function(a,b){if(a!==b)return q("watch",{oldValue:b})});return l(a).bind("blur",function(){return h.$apply(function(){return q("blur")})})}}};r.$inject=["$injector"];p.directive("validator",r)}).call(this);(function(){angular.module("validator",["validator.directive"])}).call(this);
(function(){var l;l=angular.element;angular.module("validator.provider",[]).provider("$validator",function(){var p,r,t,h=this;t=r=p=null;this.rules={};this.broadcastChannel={prepare:"$validatePrepare",start:"$validateStart",reset:"$validateReset"};this.setupProviders=function(a){p=a;r=p.get("$q");return t=p.get("$timeout")};this.convertError=function(a){var c;if("function"===typeof a)return a;c=a.constructor===String?a:"";return function(a,b,g){var d,e,k,h;d=l(b).parent();for(a=[];0!==d.length;){if(d.hasClass("form-group")){d.addClass("has-error");
h=d.find("label");e=0;for(k=h.length;e<k;e++)d=h[e],l(d).hasClass("error")&&l(d).remove();d=l("<label class='control-label error'>"+c+"</label>");g.id&&d.attr("for",g.id);l(b).parent().append(d);break}a.push(d=d.parent())}return a}};this.convertSuccess=function(a){return"function"===typeof a?a:function(a,f){var b,g,d,e,k;b=l(f).parent();for(k=[];0!==b.length;){if(b.hasClass("has-error")){b.removeClass("has-error");e=b.find("label");g=0;for(d=e.length;g<d;g++)b=e[g],l(b).hasClass("error")&&l(b).remove();
break}k.push(b=b.parent())}return k}};this.convertValidator=function(a){var c;c=function(){};a.constructor===RegExp?c=function(c,b,g,d,e){null==c&&(c="");return a.test(c)?"function"===typeof e.success?e.success():void 0:"function"===typeof e.error?e.error():void 0}:"function"===typeof a&&(c=function(c,b,g,d,e){return r.all([a(c,b,g,d,p)]).then(function(a){return a&&0<a.length&&a[0]?"function"===typeof e.success?e.success():void 0:"function"===typeof e.error?e.error():void 0},function(){return"function"===
typeof e.error?e.error():void 0})});return c};this.convertRule=function(a,c){var f,b,g,d;null==c&&(c={});f={name:a,enableError:"watch"===c.invoke,invoke:c.invoke,filter:null!=(b=c.filter)?b:function(a){return a},validator:null!=(g=c.validator)?g:function(){return!0},error:null!=(d=c.error)?d:"",success:c.success};f.error=h.convertError(f.error);f.success=h.convertSuccess(f.success);f.validator=h.convertValidator(f.validator);return f};this.register=function(a,c){null==c&&(c={});return this.rules[a]=
this.convertRule(a,c)};this.getRule=function(a){return this.rules[a]?this.rules[a]:null};this.validate=function(a,c){var f,b,g,d,e,k,l;l=r.defer().promise;e=d=g=0;f=[];b=[];l.success=function(a){f.push(a);return l};l.error=function(a){b.push(a);return l};k={model:c,accept:function(){return g++},success:function(){var a,b,c;if(++d===g)for(b=0,c=f.length;b<c;b++)a=f[b],a();return d},error:function(){var a,c,d;if(0===e++)for(c=0,d=b.length;c<d;c++)a=b[c],a();return e}};a.$broadcast(h.broadcastChannel.prepare,
k);t(function(){var b,c,d;if(0===g)for(c=0,d=f.length;c<d;c++)b=f[c],b();else return b=p.get("$validator"),a.$broadcast(b.broadcastChannel.start,k)});return l};this.reset=function(a,c){return a.$broadcast(h.broadcastChannel.reset,{model:c})};this.get=function(a){this.setupProviders(a);return{rules:this.rules,broadcastChannel:this.broadcastChannel,register:this.register,convertRule:this.convertRule,getRule:this.getRule,validate:this.validate,reset:this.reset}};this.get.$inject=["$injector"];this.$get=
this.get})}).call(this);
