(function(){var p,q,s;p=angular.element;q=angular.module("validator.directive",["validator.provider"]);s=function(q){return{restrict:"A",require:"ngModel",link:function(g,c,f){var a,d,h,e,b,k,l,m,r;d=q.get("$validator");a=q.get("$parse");e=a(f.ngModel);m=[];r=function(n,t){var b,d,a,h,k,r,l;null==t&&(t={});h=0;d=function(){var n,a,b;if(++h===m.length){a=0;for(b=m.length;a<b;a++)n=m[a],n.success(g,c,f);"function"===typeof t.success&&t.success()}};l=[];k=0;for(r=m.length;k<r;k++){a=m[k];switch(n){case "blur":if("blur"!==
a.invoke)continue;a.enableError=!0;break;case "watch":if("watch"!==a.invoke&&!a.enableError){d();continue}break;case "broadcast":a.enableError=!0}b=a.filter(e(g));void 0===b&&"watch"===n?e.assign(g,t.oldValue):e.assign(g,b);l.push(a.validator(e(g),g,c,f,{success:function(){return d()},error:function(){a.enableError&&a.error(g,c,f);if(1===("function"===typeof t.error?t.error():void 0))try{return c[0].scrollIntoViewIfNeeded()}catch(n){}}}))}return l};k=function(){var n;n=d.getRule("required");null==
n&&(n=d.convertRule("required",{validator:/^.+$/,invoke:"watch"}));return m.push(n)};l=function(n){var a,b,d,e,h;h=[];a=b=0;for(d=m.length;b<d;a=b+=1)(null!=(e=m[a])?e.name:void 0)===n&&(m[a].success(g,c,f),m.splice(a,1),h.push(a--));return h};f.$observe("validator",function(a){var c,e,h,g;m.length=0;(b.validatorRequired||b.required)&&k();if(c=a.match(/^\/(.*)\/$/))e=d.convertRule("dynamic",{validator:RegExp(c[1]),invoke:f.validatorInvoke,error:f.validatorError}),m.push(e);else if(c=a.match(/^\[(.*)\]$/)){a=
c[1].split(",");g=[];c=0;for(h=a.length;c<h;c++)e=a[c],(e=d.getRule(e.replace(/^\s+|\s+$/g,"")))?g.push(m.push(e)):g.push(void 0);return g}});f.$observe("validatorError",function(a){var b;if(b=f.validator.match(/^\/(.*)\/$/))return l("dynamic"),a=d.convertRule("dynamic",{validator:RegExp(b[1]),invoke:f.validatorInvoke,error:a}),m.push(a)});b={validatorRequired:!1,required:!1};f.$observe("validatorRequired",function(a){if(a&&"false"!==a)return k(),b.validatorRequired=!0;if(b.validatorRequired)return l("required"),
b.validatorRequired=!1});f.$observe("required",function(a){if(a&&"false"!==a)return k(),b.required=!0;if(b.required)return l("required"),b.required=!1});h=function(b,c){var e,d;if(c){if(f.validatorGroup===c)return!0;if(b.targetScope===g)return 0===f.ngModel.indexOf(c);e=function(a,b){var c,d;for(c in a)switch(d=a[c],typeof d){case "string":if("$$hashKey"===c&&d===b)return!0;break;case "object":if(e(d,b))return!0}return!1};d=f.ngModel.indexOf(".");d=0<=d?f.ngModel.substr(0,d):f.ngModel;d=a(d)(g);return e(a(c)(b.targetScope),
d.$$hashKey)}return!0};g.$on(d.broadcastChannel.prepare,function(a,b){if(h(a,b.model))return b.accept()});g.$on(d.broadcastChannel.start,function(a,b){if(h(a,b.model))return r("broadcast",{success:b.success,error:b.error})});g.$on(d.broadcastChannel.reset,function(a,b){var d,e,k,r;if(h(a,b.model)){r=[];e=0;for(k=m.length;e<k;e++)d=m[e],r.push(d.success(g,c,f));return r}});g.$watch(f.ngModel,function(a,b){if(a!==b)return r("watch",{oldValue:b})});return p(c).bind("blur",function(){return g.$apply(function(){return r("blur")})})}}};
s.$inject=["$injector"];q.directive("validator",s)}).call(this);(function(){angular.module("validator",["validator.directive"])}).call(this);
(function(){var p;p=angular.element;angular.module("validator.provider",[]).provider("$validator",function(){var q,s,u,g=this;u=s=q=null;this.rules={};this.broadcastChannel={prepare:"$validatePrepare",start:"$validateStart",reset:"$validateReset"};this.setupProviders=function(c){q=c;s=q.get("$q");return u=q.get("$timeout")};this.convertError=function(c){var f;if("function"===typeof c)return c;f=c.constructor===String?c:"";return function(a,d,c){var e,b,g,l;e=p(d).parent();for(a=[];0!==e.length;){if(e.hasClass("form-group")){e.addClass("has-error");
l=e.find("label");b=0;for(g=l.length;b<g;b++)e=l[b],p(e).hasClass("error")&&p(e).remove();e=p("<label class='control-label error'>"+f+"</label>");c.id&&e.attr("for",c.id);p(d).parent().append(e);break}a.push(e=e.parent())}return a}};this.convertSuccess=function(c){return"function"===typeof c?c:function(c,a){var d,g,e,b,k;d=p(a).parent();for(k=[];0!==d.length;){if(d.hasClass("has-error")){d.removeClass("has-error");b=d.find("label");g=0;for(e=b.length;g<e;g++)d=b[g],p(d).hasClass("error")&&p(d).remove();
break}k.push(d=d.parent())}return k}};this.convertValidator=function(c){var f;f=function(){};c.constructor===RegExp?f=function(a,d,f,e,b){null==a&&(a="");return c.test(a)?"function"===typeof b.success?b.success():void 0:"function"===typeof b.error?b.error():void 0}:"function"===typeof c&&(f=function(a,d,f,e,b){return s.all([c(a,d,f,e,q)]).then(function(a){return a&&0<a.length&&a[0]?"function"===typeof b.success?b.success():void 0:"function"===typeof b.error?b.error():void 0},function(){return"function"===
typeof b.error?b.error():void 0})});return f};this.convertRule=function(c,f){var a,d,h,e;null==f&&(f={});a={name:c,enableError:"watch"===f.invoke,invoke:f.invoke,filter:null!=(d=f.filter)?d:function(a){return a},validator:null!=(h=f.validator)?h:function(){return!0},error:null!=(e=f.error)?e:"",success:f.success};a.error=g.convertError(a.error);a.success=g.convertSuccess(a.success);a.validator=g.convertValidator(a.validator);return a};this.register=function(c,f){null==f&&(f={});return this.rules[c]=
this.convertRule(c,f)};this.getRule=function(c){return this.rules[c]?this.rules[c]:null};this.validate=function(c,f){var a,d,h,e,b,k,l;l=s.defer().promise;b=e=h=0;a=[];d=[];l.success=function(b){a.push(b);return l};l.error=function(a){d.push(a);return l};k={model:f,accept:function(){return h++},success:function(){var b,c,d;if(++e===h)for(c=0,d=a.length;c<d;c++)b=a[c],b();return e},error:function(){var a,c,e;if(0===b++)for(c=0,e=d.length;c<e;c++)a=d[c],a();return b}};c.$broadcast(g.broadcastChannel.prepare,
k);u(function(){var b,d,e;if(0===h)for(d=0,e=a.length;d<e;d++)b=a[d],b();else return b=q.get("$validator"),c.$broadcast(b.broadcastChannel.start,k)});return l};this.reset=function(c,f){return c.$broadcast(g.broadcastChannel.reset,{model:f})};this.get=function(c){this.setupProviders(c);return{rules:this.rules,broadcastChannel:this.broadcastChannel,register:this.register,convertRule:this.convertRule,getRule:this.getRule,validate:this.validate,reset:this.reset}};this.get.$inject=["$injector"];this.$get=
this.get})}).call(this);
