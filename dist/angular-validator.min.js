(function(){var m,h,l;m=angular.element;h=angular.module("validator.directive",[]);l=function(h){return{restrict:"A",require:"ngModel",link:function(g,l,a){var d,e,p,b,k,f,c,n;d=h.get("$validator");p=h.get("$parse")(a.ngModel);k=[];f=function(b,c){var f,n,e,d,h;null==c&&(c={success:function(){},error:function(){}});n=0;h=[];e=0;for(d=k.length;e<d;e++){f=k[e];switch(b){case "blur":if("blur"!==f.invoke)continue;f.enableError=!0;break;case "watch":if("watch"!==f.invoke&&!f.enableError)continue;break;
case "broadcast":f.enableError=!0}p.assign(g,f.filter(p(g)));h.push(f.validator(p(g),g,l,a,{success:function(){if(++n===k.length)return c.success()},error:function(){return c.error()}}))}return h};if(e=a.validator.match(/^\/(.*)\/$/))e=d.convertRule({validator:RegExp(e[1]),invoke:a.validatorInvoke,error:a.validatorError}),k.push(e);if(e=a.validator.match(/^\[(.*)\]$/))for(b=e[1].split(","),c=0,n=b.length;c<n;c++)e=b[c],k.push(d.getRule(e.trim()));g.$on(d.broadcastChannel.prepare,function(f,b){if(!b.model||
0===a.ngModel.indexOf(b.model))return b.accept()});g.$on(d.broadcastChannel.start,function(b,c){if(!c.model||0===a.ngModel.indexOf(c.model))return f("broadcast",{success:c.success,error:c.error})});g.$watch(a.ngModel,function(b,c){if(b!==c)return f("watch")});return m(l).bind("blur",function(){return g.$apply(function(){return f("blur")})})}}};l.$inject=["$injector"];h.directive("validator",l)}).call(this);(function(){angular.module("validator",["validator.provider","validator.directive"])}).call(this);
(function(){var m;m=angular.element;angular.module("validator.provider",[]).provider("$validator",function(){var h,l,q,g,r=this;l=h=null;this.rules={};this.broadcastChannel={prepare:"$validateStartPrepare",start:"$validateStartStart"};q={all:function(){for(var a in this)if("all"!==a)this[a]()}};g=function(a){h=a;return l=h.get("$q")};this.convertRule=function(a){var d,e,g,b,k;null==a&&(a={});b={enableError:"watch"===a.invoke,invoke:a.invoke,filter:a.filter,validator:a.validator,error:a.error,success:a.success};
null==b.filter&&(b.filter=function(b){return b});null==b.validator&&(b.validator=function(){return!0});null==b.error&&(b.error="");b.error.constructor===String&&(d=b.error,b.error=function(b){var c,a;c=m(b).parent();for(a=1;3>=a;++a){if(c.hasClass("form-group")){if(c.hasClass("has-error"))break;m(b).parent().append("<label class='control-label error'>"+d+"</label>");c.addClass("has-error");break}c=c.parent()}});k=function(b){var c,a,e,d;c=m(b).parent();b=[];for(a=1;3>=a;++a){if(c.hasClass("has-error")){c.removeClass("has-error");
d=c.find("label");a=0;for(e=d.length;a<e;a++)if(c=d[a],m(c).hasClass("error")){c.remove();break}break}b.push(c=c.parent())}return b};b.success&&"function"===typeof b.success?(e=b.success,b.success=function(b,a){e(b,a);return k(b,a)}):b.success=k;b.validator.constructor===RegExp?(g=b.validator,b.validator=function(a,c,e,d,h){if(g.test(a))return b.success(e,d),"function"===typeof h.success?h.success():void 0;b.enableError&&b.error(e,d);return"function"===typeof h.error?h.error():void 0}):"function"===
typeof b.validator&&(e=b.validator,b.validator=function(a,c,d,g,k){return l.all([e(a,c,d,g,h)]).then(function(a){if(a&&0<a.length&&a[0])return b.success(d,g),"function"===typeof k.success?k.success():void 0;b.enableError&&b.error(d,g);return"function"===typeof k.error?k.error():void 0})});return b};this.register=function(a,d){null==d&&(d={});return this.rules[a]=this.convertRule(d)};this.getRule=function(a){return this.rules[a]?this.rules[a]:null};this.validate=function(a,d){var e,g,b,k,f,c;c=l.defer().promise;
b=g=e=0;f={success:function(){},error:function(){},accept:function(){return e++},validatedSuccess:function(){if(++g===e)return f.success()},validatedError:function(){if(0===b++)return f.error()}};c.success=function(a){return f.success=a};c.error=function(a){return f.error=a};k={model:d,accept:f.accept,success:f.validatedSuccess,error:f.validatedError};a.$broadcast(r.broadcastChannel.prepare,k);setTimeout(function(){return a.$apply(function(){var b;b=h.get("$validator");return a.$broadcast(b.broadcastChannel.start,
k)})},0);return c};this.get=function(a){g(a);q.all();return{rules:this.rules,broadcastChannel:this.broadcastChannel,convertRule:this.convertRule,getRule:this.getRule,validate:this.validate}};this.get.$inject=["$injector"];return this.$get=this.get})}).call(this);
