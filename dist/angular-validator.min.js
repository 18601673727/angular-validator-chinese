(function(){var n,p,q;n=angular.element;p=angular.module("validator.directive",["validator.provider"]);q=function(p){return{restrict:"A",require:"ngModel",link:function(g,d,c){var f,a,k,b,h,e,l,r,m,s,q;a=p.get("$validator");f=p.get("$parse");h=f(c.ngModel);r=[];m=function(a,b){var f,e,k,m,l,s;null==b&&(b={});k=0;s=[];m=0;for(l=r.length;m<l;m++){e=r[m];switch(a){case "blur":if("blur"!==e.invoke)continue;e.enableError=!0;break;case "watch":if("watch"!==e.invoke&&!e.enableError)continue;break;case "broadcast":e.enableError=
!0}f=e.filter(h(g));!1===f&&"watch"===a?h.assign(g,b.oldValue):h.assign(g,f);s.push(e.validator(h(g),g,d,c,{success:function(){if(++k===r.length)return e.success(g,d,c),"function"===typeof b.success?b.success():void 0},error:function(){e.enableError&&e.error(g,d,c);if(1===("function"===typeof b.error?b.error():void 0))try{return d[0].scrollIntoViewIfNeeded()}catch(f){}}}))}return s};if(b=c.validator.match(/^\/(.*)\/$/))e=a.convertRule("dynamic",{validator:RegExp(b[1]),invoke:c.validatorInvoke,error:c.validatorError}),
r.push(e);if(b=c.validator.match(/^\[(.*)\]$/))for(l=b[1].split(","),s=0,q=l.length;s<q;s++)b=l[s],(e=a.getRule(b.replace(/^\s+|\s+$/g,"")))&&r.push(e);c.required&&(e=a.getRule("required"),null==e&&(e=a.convertRule("required",{validator:/^.+$/,invoke:"watch"})),r.push(e));k=function(b,e){var d,a;if(e){if(b.targetScope===g)return 0===c.ngModel.indexOf(e);d=function(a,b){var c,e;for(c in a)switch(e=a[c],typeof e){case "string":if("$$hashKey"===c&&e===b)return!0;break;case "object":if(d(e,b))return!0}return!1};
a=c.ngModel.indexOf(".");a=0<=a?c.ngModel.substr(0,a):c.ngModel;a=f(a)(g);return d(f(e)(b.targetScope),a.$$hashKey)}return!0};g.$on(a.broadcastChannel.prepare,function(a,b){if(k(a,b.model))return b.accept()});g.$on(a.broadcastChannel.start,function(b,a){if(k(b,a.model))return m("broadcast",{success:a.success,error:a.error})});g.$on(a.broadcastChannel.reset,function(a,b){var f,h,m;if(k(a,b.model)){m=[];f=0;for(h=r.length;f<h;f++)e=r[f],m.push(e.success(g,d,c));return m}});g.$watch(c.ngModel,function(a,
b){if(a!==b)return m("watch",{oldValue:b})});return n(d).bind("blur",function(){return g.$apply(function(){return m("blur")})})}}};q.$inject=["$injector"];p.directive("validator",q)}).call(this);(function(){angular.module("validator",["validator.directive"])}).call(this);
(function(){var n;n=angular.element;angular.module("validator.provider",[]).provider("$validator",function(){var p,q,t,g=this;t=q=p=null;this.rules={};this.broadcastChannel={prepare:"$validatePrepare",start:"$validateStart",reset:"$validateReset"};this.setupProviders=function(d){p=d;q=p.get("$q");return t=p.get("$timeout")};this.convertError=function(d){var c;if("function"===typeof d)return d;c=d.constructor===String?d:"";return function(f,a,d){var b,h,e,g;b=n(a).parent();for(f=[];0!==b.length;){if(b.hasClass("form-group")){b.addClass("has-error");
g=b.find("label");h=0;for(e=g.length;h<e;h++)b=g[h],n(b).hasClass("error")&&n(b).remove();b=n("<label class='control-label error'>"+c+"</label>");d.id&&b.attr("for",d.id);n(a).parent().append(b);break}f.push(b=b.parent())}return f}};this.convertSuccess=function(d){return"function"===typeof d?d:function(c,d){var a,g,b,h,e;a=n(d).parent();for(e=[];0!==a.length;){if(a.hasClass("has-error")){a.removeClass("has-error");h=a.find("label");g=0;for(b=h.length;g<b;g++)a=h[g],n(a).hasClass("error")&&n(a).remove();
break}e.push(a=a.parent())}return e}};this.convertValidator=function(d){var c;c=function(){};d.constructor===RegExp?c=function(c,a,g,b,h){null==c&&(c="");return d.test(c)?"function"===typeof h.success?h.success():void 0:"function"===typeof h.error?h.error():void 0}:"function"===typeof d&&(c=function(c,a,g,b,h){return q.all([d(c,a,g,b,p)]).then(function(a){return a&&0<a.length&&a[0]?"function"===typeof h.success?h.success():void 0:"function"===typeof h.error?h.error():void 0},function(){return"function"===
typeof h.error?h.error():void 0})});return c};this.convertRule=function(d,c){var f,a,k,b;null==c&&(c={});f={name:d,enableError:"watch"===c.invoke,invoke:c.invoke,filter:null!=(a=c.filter)?a:function(a){return a},validator:null!=(k=c.validator)?k:function(){return!0},error:null!=(b=c.error)?b:"",success:c.success};f.error=g.convertError(f.error);f.success=g.convertSuccess(f.success);f.validator=g.convertValidator(f.validator);return f};this.register=function(d,c){null==c&&(c={});return this.rules[d]=
this.convertRule(d,c)};this.getRule=function(d){return this.rules[d]?this.rules[d]:null};this.validate=function(d,c){var f,a,k,b,h,e,l;l=q.defer().promise;h=b=k=0;f=[];a=[];l.success=function(a){f.push(a);return l};l.error=function(b){a.push(b);return l};e={model:c,accept:function(){return k++},success:function(){var a,c,d;if(++b===k)for(c=0,d=f.length;c<d;c++)a=f[c],a();return b},error:function(){var b,c,d;if(0===h++)for(c=0,d=a.length;c<d;c++)b=a[c],b();return h}};d.$broadcast(g.broadcastChannel.prepare,
e);t(function(){var a,b,c;if(0===k)for(b=0,c=f.length;b<c;b++)a=f[b],a();else return a=p.get("$validator"),d.$broadcast(a.broadcastChannel.start,e)});return l};this.reset=function(d,c){return d.$broadcast(g.broadcastChannel.reset,{model:c})};this.get=function(d){this.setupProviders(d);return{rules:this.rules,broadcastChannel:this.broadcastChannel,register:this.register,convertRule:this.convertRule,getRule:this.getRule,validate:this.validate,reset:this.reset}};this.get.$inject=["$injector"];this.$get=
this.get})}).call(this);
